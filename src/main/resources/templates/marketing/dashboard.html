<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{fragment/dashboardHeader :: header}"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<body id="page-top">
<div th:replace="~{fragment/dashboardHeader :: navbar}"> </div>

<div id="wrapper">
    <!-- Sidebar -->
    <div th:replace="~{fragment/dashboardHeader :: sidebar}"> </div>
    <div id="content-wrapper">
        <div class="container-fluid">
            <!-- Breadcrumbs-->
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a th:href="@{/posts/dashboard}">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Overview</li>
            </ol>
            <div class="row">
                <div class="col-xl-4 col-sm-6 mb-3">
                    <div class="card text-white bg-primary o-hidden h-100">
                        <div class="card-body">
                            <div class="card-body-icon">
                                <i class="fas fa-fw fa-comments"></i>
                            </div>
                            <div class="mr-5" th:text="${totalPost + ' Total Posts'}"></div>
                        </div>
                        <a class="card-footer text-white clearfix small z-1" href="/posts/dashboard">
                            <span class="float-left">View Details</span>
                            <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
                        </a>
                    </div>
                </div>
                <div class="col-xl-4 col-sm-6 mb-3">
                    <div class="card text-white bg-warning o-hidden h-100">
                        <div class="card-body">
                            <div class="card-body-icon">
                                <i class="fas fa-fw fa-list"></i>
                            </div>
                            <div class="mr-5" th:text="${ totalComments + ' Total Comments'}"></div>
                        </div>
                        <a class="card-footer text-white clearfix small z-1" href="/ManagerDashBoard/productList/activeProduct">
                            <span class="float-left">View Details</span>
                            <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
                        </a>
                    </div>
                </div>
                <div class="col-xl-4 col-sm-6 mb-3">
                    <div class="card text-white bg-success o-hidden h-100">
                        <div class="card-body">
                            <div class="card-body-icon">
                                <i class="fas fa-fw fa-shopping-cart"></i>
                            </div>
                            <div class="mr-5" th:text="${ totalVisitor + '  Visitor Count'}"></div>
                        </div>
                        <a class="card-footer text-white clearfix small z-1" href="/ManagerDashBoard/productList/inActiveProduct">
                            <span class="float-left">View Details</span>
                            <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
                        </a>
                    </div>
                </div>
            </div>

            <canvas id="lineChart" width="600" height="400"></canvas>

            <script>
                // Function to extract data from Thymeleaf
                function getDataFromThymeleaf() {
                    const postsByDayInWeek = /*[[${postsByDayInWeek}]]*/ {};
                    const postsByWeekInMonth = /*[[${postsByWeekInMonth}]]*/ {};
                    const postsByMonthInYear = /*[[${postsByMonthInYear}]]*/ {};

                    return {
                        postsByDayInWeek: JSON.parse(/*[[${postsByDayInWeek}]]*/ '{}'),
                        postsByWeekInMonth: JSON.parse(/*[[${postsByWeekInMonth}]]*/ '{}'),
                        postsByMonthInYear: JSON.parse(/*[[${postsByMonthInYear}]]*/ '{}')
                    };
                }

                // Function to process the data for the chart
                function processPostData(data) {
                    const labels = Object.keys(data.postsByDayInWeek);
                    const dayData = labels.map(day => data.postsByDayInWeek[day].length);

                    return {
                        labels,
                        datasets: [{
                            label: 'Posts by Day in Week',
                            data: dayData,
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    };
                }

                // Function to initialize the chart
                function initChart() {
                    const postData = getDataFromThymeleaf();
                    const processedData = processPostData(postData);

                    var ctx = document.getElementById('lineChart').getContext('2d');
                    var lineChart = new Chart(ctx, {
                        type: 'line',
                        data: processedData,
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true // Start the y-axis at zero
                                }
                            }
                        }
                    });
                }

                // Initialize the chart when the page loads
                window.onload = initChart;
            </script>

            <script>
                var ctx = document.getElementById('areaChart').getContext('2d');
                var areaChart = new Chart(ctx, {
                    type: 'line', // Use 'line' type to create an area chart
                    data: {
                        labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'], // X-axis labels
                        datasets: [{
                            label: 'Cumulative Visitors', // Label for the dataset
                            data: [10, 30, 60, 85, 120, 160, 210], // Cumulative data points
                            backgroundColor: 'rgba(153, 102, 255, 0.2)', // Background color for area
                            borderColor: 'rgba(153, 102, 255, 1)', // Line color
                            borderWidth: 1, // Line width
                            fill: true // Fill the area under the line
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true // Start the y-axis at zero
                            }
                        }
                    }
                });
            </script>
            <div class="card mb-3">
                <div class="card-header h3">
                    <i class="fas fa-table"></i>
                    Post
                </div>
                <br>
                <div class="row d-flex justify-content-center">
                    <div class="col-md-3 ml-3">
                        <div class="form-group">
                            <form class="form-inline" th:action="@{/posts/search}">
                                <div class="input-group w-100">
                                    <input type="text" class="form-control" name="query" placeholder="Search by post title..."/>
                                    <span class="input-group-btn">
                                        <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <!--                        <a class="btn btn-primary" href="#">Add order</a>-->
                        <table class="table table-top" id="dataTable">
                            <thead>
                            <tr>
                                <th class="col-1">ID</th>
                                <th class="col-2">Post Title</th>
                                <th class="col-3">Short Description</th>
                                <th class="col-1">Created On</th>
                                <th class="col-2">Created By</th>
                                <th class="col-3">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each = "post, postStat : ${posts}">
                                <td th:text="${postStat.count}">1</td>
                                <td th:text="${post.title}">Post Title</td>
                                <td th:text="${post.shortDescription}">Post Short Description</td>
                                <td th:text="${#temporals.format(post.createdOn, 'dd MMM yyyy')}">Post Created Date</td>
                                <td th:text="${post.createdBy.email}"></td>
                                <td>
                                    <a th:href="@{/posts/{postId}/edit(postId=${post.id})}" class="btn btn-primary">Edit</a>
                                    <a th:href="@{/posts/{postId}/delete(postId=${post.id})}" class="btn btn-danger">Delete</a>
                                    <a th:href="@{/posts/{postUrl}/view(postUrl=${post.url})}" class="btn btn-info">View</a>
                                    <a th:href="@{/posts/{postId}/comments(postId=${post.id})}" class="btn btn-success">Comments</a>
                                </td>
                            </tr>
                            </tbody>
                            <tfoot>

                            </tfoot>

                        </table>
                    </div>
                </div>
                <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
            </div>
        </div>

        <div th:replace="~{fragment/dashboardFooter :: footer}"> </div>

    </div>
</div>
<!-- /#wrapper -->
<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>
<div th:replace="~{fragment/dashboardFooter :: logout-module}"> </div>

<!-- Bootstrap core JavaScript-->
<!-- Source fragment for script imports -->
<div th:replace="~{fragment/dashboardFooter :: source}"></div>

<!-- Notify.js JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>

<!-- Include Thymeleaf template engine -->
<script th:inline="javascript">
    /*<![CDATA[*/
    var successMessage = /*[[${successMessage}]]*/ 'null';
    /*]]>*/
</script>

<!-- Inline script to show notification -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (successMessage && successMessage !== 'null') {
            $.notify(successMessage, {
                className: "success",
                globalPosition: "bottom right"
            });
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>